import{_ as A,d as G,g as N,u as M,k as j,l as Q,h as _,n as H,m as J,p as O,E as g,q as W,s as X,t as Y,o as d,c as S,a,v as L,x as B,b as l,y as w,w as s,z as T,A as C,B as D,C as Z,e as I,r as u,D as x,F as ee}from"./index.8e766bde.js";import{i as oe,a as se,b as ne}from"./index.c998d848.js";import{s as ae}from"./valid-code.47c82e0d.js";var le="./assets/left.167ce885.jpg",te="./assets/wel_tips.e07b65d4.png";const re=G({name:"Login",setup(){const e=N(),o=M(),R=j();Q(()=>{b()});const V=_("dingtalk"),U=r=>{V.value=r,r==="dingtalk"&&b()},b=()=>{H(()=>{window.DTFrameLogin({id:"qr-code",width:300,height:300},{redirect_uri:encodeURIComponent(`${window.location.origin+J}/user/v1.0/login_qrcode`),client_id:"dingmag2ff0st32hsc8s",scope:"openid",response_type:"code",state:"STATE",prompt:"consent"},r=>{const{authCode:c}=r;console.log(r),console.log(c),$("user/loginByQRCode",{authCode:c})},r=>{alert(`Login Error: ${r}`)})})},n=O({loginType:V,loading:!1,username:"",password:"",phone:"",validSmsCode:""}),p=_("password"),f=()=>{p.value===""?p.value="password":p.value=""},i=()=>n.username?!0:(g.warning({message:"\u8BF7\u8F93\u5165\u7528\u6237\u540D",type:"warning"}),!1),h=()=>n.password?oe(n.password)?!0:(g.warning({message:"\u5BC6\u7801\u683C\u5F0F\u4E0D\u6B63\u786E",type:"warning"}),!1):(g.warning({message:"\u8BF7\u8F93\u5165\u5BC6\u7801",type:"warning"}),!1),v=_(!1),y=_(!1),m=_(300),t=()=>n.phone?se(n.phone)?!0:(g.warning({message:"\u624B\u673A\u53F7\u683C\u5F0F\u4E0D\u6B63\u786E",type:"warning"}),!1):(g.warning({message:"\u8BF7\u5148\u8F93\u5165\u624B\u673A\u53F7",type:"warning"}),!1),F=()=>!n.validSmsCode||!ne(n.validSmsCode)?(g.warning({message:"\u8BF7\u8F93\u51656\u4F4D\u6570\u5B57\u9A8C\u8BC1\u7801",type:"warning"}),!1):!0;let P=null;const q=()=>{!t()||ae(n).then(r=>{y.value=!0,P&&clearInterval(P),P=setInterval(()=>{m.value=m.value-1,m.value===0&&(clearInterval(P),y.value=!1,m.value=300)},1e3)})},z=()=>{v.value=!0},E=()=>{if(!i()||!h())return;const r={username:n.username,password:n.password};Z(r).then(c=>{n.phone=c.data,n.showPhone=c.data.replace(/^(\d{3})\d{4}(\d{4})$/,"$1****$2"),v.value=!0})},K=()=>{if(!i()||!h()||!t()||!F())return;const r={username:n.username,password:n.password,phone:n.phone,validCode:n.validSmsCode};$("user/login",r)},$=(r,c)=>{e.dispatch(r,c).then(()=>{g.success({message:"\u767B\u5F55\u6210\u529F",type:"success",showClose:!0,duration:1e3}),W(),o.push(R.query.redirect||"/")})};return{systemTitle:X,systemSubTitle:Y,loginType:V,onLoginTypeClick:U,form:n,passwordType:p,passwordTypeChange:f,dialogFormVisible:v,showCountDown:y,countDown:m,handleFormClose:z,onValidSmsCodeClick:q,onLoginGetPhone:E,onLoginByPasswordPhone:K,onUpdatePassword:()=>{o.push("/update_password")},onResetPassword:()=>{o.push("/reset_password")}}}}),k=e=>(x("data-v-dbec254a"),e=e(),ee(),e),de={class:"passport-container"},ie={class:"passport-container-inner"},pe={class:"passport-notes"},ue=k(()=>a("img",{src:le,alt:""},null,-1)),me={class:"notes"},ce={class:"passport-main"},ge=k(()=>a("div",{class:"welcome-tips"},[a("span",null,"\u7EC8\u4E8E\u7B49\u5230\u4F60~"),a("img",{src:te,alt:""})],-1)),we={class:"login-box"},fe={class:"login-box-tabs"},he={class:"login-box-form"},ve=k(()=>a("div",{id:"qr-code",class:"qr-code"},null,-1)),ye=k(()=>a("span",{class:"title"},"\u6253\u5F00\u9489\u9489\u626B\u4E00\u626B\uFF0C\u5FEB\u901F\u767B\u5F55/\u6CE8\u518C",-1)),_e=I("\u767B\u5F55"),Ce=I("\u4FEE\u6539\u5BC6\u7801"),ke=k(()=>a("div",{class:"login-box-bottom"},null,-1)),Ve={key:1,class:"valid-code count-down"},Pe=I("\u786E\u8BA4");function Te(e,o,R,V,U,b){const n=u("el-divider"),p=u("el-form"),f=u("el-input"),i=u("el-form-item"),h=u("el-button"),v=u("el-link"),y=u("el-col"),m=u("el-dialog");return d(),S("div",de,[a("div",ie,[a("div",pe,[ue,a("div",me,[a("div",null,L(e.systemTitle),1),a("div",null,L(e.systemSubTitle),1)])]),a("div",ce,[ge,a("div",we,[a("div",fe,[a("h3",{class:B(["tab",e.loginType==="dingtalk"?"active":""]),onClick:o[0]||(o[0]=t=>e.onLoginTypeClick("dingtalk"))},"\u9489\u9489\u626B\u7801",2),l(n,{direction:"vertical"}),a("h3",{class:B(["tab",e.loginType==="password"?"active":""]),onClick:o[1]||(o[1]=t=>e.onLoginTypeClick("password"))},"\u5BC6\u7801\u767B\u5F55",2)]),a("div",he,[e.loginType==="dingtalk"?(d(),w(p,{key:0,class:"form dingtalk"},{default:s(()=>[ve,ye]),_:1})):T("",!0),e.loginType==="password"?(d(),w(p,{key:1,class:"form password",onKeydown:D(e.onLoginGetPhone,["enter"])},{default:s(()=>[l(i,null,{default:s(()=>[l(f,{ref:"username",type:"text",modelValue:e.form.username,"onUpdate:modelValue":o[2]||(o[2]=t=>e.form.username=t),placeholder:"\u7528\u6237\u540D/\u624B\u673A\u53F7/\u90AE\u7BB1",size:"large",maxlength:"50"},{prepend:s(()=>[(d(),w(C(e.useRenderIcon("user","svg"))))]),_:1},8,["modelValue"])]),_:1}),l(i,null,{default:s(()=>[l(f,{ref:"password",type:e.passwordType,modelValue:e.form.password,"onUpdate:modelValue":o[3]||(o[3]=t=>e.form.password=t),placeholder:"\u5BC6\u7801",size:"large",maxlength:"50"},{prepend:s(()=>[(d(),w(C(e.useRenderIcon("lock","svg"))))]),append:s(()=>[(d(),w(C(e.useRenderIcon(e.passwordType?"eye-close":"eye-open","svg")),{onClick:e.passwordTypeChange},null,8,["onClick"]))]),_:1},8,["type","modelValue"])]),_:1}),l(i,null,{default:s(()=>[l(h,{type:"primary",loading:e.form.loading,onClick:e.onLoginGetPhone,style:{width:"100%"}},{default:s(()=>[_e]),_:1},8,["loading","onClick"]),l(y,{class:"link"},{default:s(()=>[l(v,{class:"link-text",underline:!1,onClick:e.onUpdatePassword},{default:s(()=>[Ce]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["onKeydown"])):T("",!0)]),ke])])]),l(m,{top:"30vh",title:"\u77ED\u4FE1\u9A8C\u8BC1",width:"30%",modelValue:e.dialogFormVisible,"onUpdate:modelValue":o[7]||(o[7]=t=>e.dialogFormVisible=t),onClose:e.handleFormClose},{default:s(()=>[l(p,{class:"dialog-phone-form",onKeydown:D(e.onLoginByPasswordPhone,["enter"])},{default:s(()=>[l(i,null,{default:s(()=>[l(f,{ref:"phone",type:"text",modelValue:e.form.showPhone,"onUpdate:modelValue":o[4]||(o[4]=t=>e.form.showPhone=t),placeholder:"\u624B\u673A\u53F7",size:"large",maxlength:"50"},{prepend:s(()=>[(d(),w(C(e.useRenderIcon("phone","svg"))))]),_:1},8,["modelValue"])]),_:1}),l(i,null,{default:s(()=>[l(f,{ref:"validCode",type:"text",modelValue:e.form.validSmsCode,"onUpdate:modelValue":o[6]||(o[6]=t=>e.form.validSmsCode=t),placeholder:"6\u4F4D\u6570\u5B57\u9A8C\u8BC1\u7801",size:"large",maxlength:"50"},{prepend:s(()=>[(d(),w(C(e.useRenderIcon("message","svg"))))]),append:s(()=>[e.showCountDown?T("",!0):(d(),S("span",{key:0,class:"valid-code send",onClick:o[5]||(o[5]=(...t)=>e.onValidSmsCodeClick&&e.onValidSmsCodeClick(...t))},"\u53D1\u9001\u9A8C\u8BC1\u7801")),e.showCountDown?(d(),S("span",Ve,L(e.countDown)+"s\u540E\u91CD\u65B0\u83B7\u53D6",1)):T("",!0)]),_:1},8,["modelValue"])]),_:1}),l(i,null,{default:s(()=>[l(h,{type:"primary",loading:e.form.loading,onClick:e.onLoginByPasswordPhone,style:{width:"100%"}},{default:s(()=>[Pe]),_:1},8,["loading","onClick"])]),_:1})]),_:1},8,["onKeydown"])]),_:1},8,["modelValue","onClose"])])}var $e=A(re,[["render",Te],["__scopeId","data-v-dbec254a"]]);export{$e as default};
